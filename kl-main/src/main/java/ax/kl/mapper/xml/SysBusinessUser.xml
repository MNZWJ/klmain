<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ax.kl.mapper.SysBusinessUserMapper">

    <!--根据机构查询人员列表-->
    <select id="getBusinessUserList" resultType="ax.kl.entity.SysBusinessUser">
        SELECT UserId as userId,UserName as userName,LoginName as loginName,DeptId as deptId,
                CreateUserId as createUserId,CreateDeptId as createDeptId,CreateTime as createTime,
                Sex as sex,DeptCode as deptCode,Telephone as telephone
        FROM TB_SYS_BUSINESSUSER
        WHERE 1=1
        <if test="typeCode != null or typeCode !='' ">
            AND DeptCode LIKE CONCAT(#{typeCode},'%')
        </if>
        <if test="searchName != null or searchName !='' ">
            AND UserName LIKE CONCAT('%',CONCAT(#{searchName}),'%')
        </if>
    </select>
    <!--更新人员-->
    <insert id="updateBusinessUser">
        update TB_SYS_BUSINESSUSER
            set Telephone=#{telephone},
                UserName=#{userName},
                Sex=#{sex},
                LoginName=#{loginName}
          WHERE UserId=#{userId}



    </insert>


    <insert id="insertBusinessUser">
        INSERT into TB_SYS_BUSINESSUSER(UserId,UserName,LoginName,DeptId,CreateUserId,CreateDeptId,Sex,DeptCode,Telephone)
        VALUES (#{userId},#{userName},#{loginName},#{deptId},#{createUserId},#{createDeptId},#{sex},#{deptCode},#{telephone})
    </insert>


    <!--单一或批量删除组织机构-->
    <delete id="deleteBusinessUser">
        delete
          from TB_SYS_BUSINESSUSER
         WHERE UserId in
        <foreach item="item" index="index" collection="array" open="(" separator="," close=")">
            #{item}
        </foreach>

        DELETE FROM  TB_SYS_USER WHERE  BusinessUserId IN
        <foreach item="item" index="index" collection="array" open="(" separator="," close=")">
            #{item}
        </foreach>

    </delete>

    <!--保存登陆表-->
    <insert id="saveUser">

        DELETE FROM TB_SYS_USER WHERE BusinessUserId=#{userId}

        INSERT INTO TB_SYS_USER(UserId,LoginName,PassWord,BusinessUserId)
        VALUES(newid(),#{loginName},#{passWord},#{userId})

    </insert>


    <select id="checkLoginName" resultType="ax.kl.entity.SysUser">
        SELECT * FROM TB_SYS_USER WHERE LoginName =#{loginName}
    </select>

    <select id="getUserInfo" resultType="ax.kl.entity.LoginInfo">
        SELECT b.UserId         AS userId,
           b.UserName       AS userName,
           org.OrganiseId   AS orgId,
           org.OrganiseCode AS orgCode,
           org.OrganiseCode AS orgCode,
           org.OrgType      AS orgType
      FROM TB_SYS_BUSINESSUSER b
     INNER JOIN TB_SYS_ORGANISE org
        ON b.DeptId = org.OrganiseId
     WHERE b.UserId = #{buserId}
    </select>

</mapper>
